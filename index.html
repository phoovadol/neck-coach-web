<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Neck Exercise Coach</title>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>

  <style>
    body { font-family: sans-serif; text-align: center; background: #eef2f3; }
    video { border-radius: 12px; margin-top: 10px; }
    #controls { margin: 15px; }
    select, button { padding: 8px; margin: 5px; border-radius: 8px; }
    #counter { font-size: 20px; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>üßò‚Äç‚ôÄÔ∏è Neck  Coach</h2>
  <video id="video" width="640" height="480" autoplay></video>

  <div id="controls">
    <select id="exercise">
      <option value="chin_tuck">Chin Tuck</option>
      <option value="side_stretch">Side Neck Stretch</option>
      <option value="rotation">Neck Rotation</option>
    </select>
    <button id="startBtn">‡πÄ‡∏£‡∏¥‡πà‡∏°</button>
    <button id="stopBtn">‡∏´‡∏¢‡∏∏‡∏î</button>
  </div>

  <div id="counter">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: 0</div>
  <audio id="beep" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

  <script>
    const video = document.getElementById('video');
    const counter = document.getElementById('counter');
    const beep = document.getElementById('beep');
    let currentExercise = 'chin_tuck';
    let count = 0;
    let detecting = false;

    document.getElementById('exercise').addEventListener('change', e => {
      currentExercise = e.target.value;
      count = 0;
      counter.textContent = "‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: 0";
    });

    document.getElementById('startBtn').addEventListener('click', () => detecting = true);
    document.getElementById('stopBtn').addEventListener('click', () => detecting = false);

    navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
      video.srcObject = stream;
    });

    const pose = new Pose.Pose({ locateFile: file => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}` });
    pose.setOptions({ modelComplexity: 1, smoothLandmarks: true });
    pose.onResults(results => {
      if (!detecting) return;

      const nose = results.poseLandmarks?.[0];
      const leftEar = results.poseLandmarks?.[7];
      const rightEar = results.poseLandmarks?.[8];
      if (!nose || !leftEar || !rightEar) return;

      let angle = rightEar.y - leftEar.y; // ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏î‡∏¥‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏´‡∏π
      if (currentExercise === 'side_stretch' && Math.abs(angle) > 0.05) { 
        count++;
        beep.play();
        counter.textContent = `‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${count}`;
      }
      // ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏° logic ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö chin_tuck, rotation ‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ
    });

    const camera = new Camera(video, { onFrame: async () => await pose.send({ image: video }), width: 640, height: 480 });
    camera.start();
  </script>
</body>
</html>
